{"version":3,"sources":["public_file_upload_b64_link.js"],"names":["ctx","data","response","name","bucket_name","region","args","EXPIRE","config","indexOf","Error","s3instance","link","getSignedUrl","Bucket","Key","Expires","ACL","json","error","message"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;;;;+BACe,WAAMA,GAAN,EAAa;AAC1B,UAAM,EAACC,IAAD,EAAOC,QAAP,KAAmB,6BAAOF,GAAP,CAAzB;AACA,QAAI;AACF,YAAM,EAACG,IAAD,EAAOC,WAAP,EAAoBC,MAApB,KAA8BL,IAAIM,IAAxC;AACA,YAAM,EAACC,SAAS,EAAV,KAAgBP,IAAIQ,MAA1B;AACA,UAAIL,KAAKM,OAAL,CAAa,GAAb,MAAsB,CAAC,CAA3B,EAA8B;AAC5B,cAAM,IAAIC,KAAJ,CAAU,gCAAV,CAAN;AACD;AACD,YAAMC,aAAa,iBAAG,EAACX,GAAD,EAAMK,MAAN,EAAH,CAAnB;AACA,YAAMO,OAAOD,WAAWE,YAAX,CAAwB,WAAxB,EAAoC;AAC/CC,gBAAQV,WADuC;AAE/CW,aAAKZ,IAF0C;AAG/Ca,iBAAST,MAHsC;AAI/CU,aAAK;AAJ0C,OAApC,CAAb;AAMA,aAAOf,SAASgB,IAAT,CAAc,EAACN,IAAD,EAAd,CAAP;AACD,KAdD,CAcE,OAAOO,KAAP,EAAc;AACd,aAAOjB,SAASgB,IAAT,CAAcC,MAAMC,OAApB,EAA6B,GAA7B,CAAP;AACD;AACF,G","file":"public_file_upload_b64_link.js","sourcesContent":["import Server from 'syncano-server'\nimport AWS from 'aws-sdk'\nimport s3 from './helpers/s3'\nexport default async ctx => {\n  const {data, response} = Server(ctx)\n  try {\n    const {name, bucket_name, region} = ctx.args\n    const {EXPIRE = 60} = ctx.config\n    if (name.indexOf('/') !== -1) {\n      throw new Error('You are not allowed to do that')\n    }\n    const s3instance = s3({ctx, region})\n    const link = s3instance.getSignedUrl('putObject',{\n      Bucket: bucket_name,\n      Key: name,\n      Expires: EXPIRE,\n      ACL: 'public-read'\n    })\n    return response.json({link})\n  } catch (error) {\n    return response.json(error.message, 400)\n  }\n}\n"]}